## Hands-On Practice

### Prerequisites

Before starting this lab, ensure you have:

<Admonition type="caution" title="Required Setup">
- ✅ Completed Week 1-2 foundational chapters
- ✅ Development environment configured (Ubuntu 22.04 LTS)
- ✅ Required software packages installed
- ✅ Access to simulation tools (Gazebo/Isaac Sim)
</Admonition>

**Hardware Requirements for This Lab:**
- None (simulation only) ✅
- Jetson Orin Nano kit required ⚠️
- Full robot hardware needed ❌

### Lab Overview

In this hands-on session, you'll build a working implementation of **{{TITLE}}** from scratch. By the end, you'll have a functional system that demonstrates the theoretical concepts covered earlier.

**What You'll Build:**
1. Basic framework setup
2. Core component implementation
3. Integration with simulation environment
4. Testing and validation

**Estimated Time:** 90-120 minutes

---

### Step 1: Environment Setup

#### 1.1 Create Project Structure

First, create a workspace for this lab:

<Tabs>
  <TabItem value="bash" label="Bash Commands" default>
    \`\`\`bash
    # Create workspace directory
    mkdir -p ~/robotics_ws/src
    cd ~/robotics_ws/src
    
    # Initialize ROS 2 workspace
    source /opt/ros/humble/setup.bash
    
    # Create package
    ros2 pkg create --build-type ament_python \\
      --dependencies rclpy std_msgs geometry_msgs \\
      physical_ai_lab
    
    cd physical_ai_lab
    \`\`\`
  </TabItem>
  
  <TabItem value="structure" label="Directory Structure">
    \`\`\`
    robotics_ws/
    ├── src/
    │   └── physical_ai_lab/
    │       ├── package.xml
    │       ├── setup.py
    │       ├── setup.cfg
    │       ├── physical_ai_lab/
    │       │   ├── __init__.py
    │       │   └── main_node.py
    │       ├── launch/
    │       │   └── lab_launch.py
    │       └── config/
    │           └── params.yaml
    \`\`\`
  </TabItem>
</Tabs>

#### 1.2 Install Dependencies

\`\`\`bash
# Update package lists
sudo apt update

# Install required packages
sudo apt install -y \\
  ros-humble-gazebo-ros-pkgs \\
  ros-humble-navigation2 \\
  python3-pip

# Install Python dependencies
pip3 install numpy scipy matplotlib
\`\`\`

<Admonition type="tip" title="Troubleshooting">
If you encounter permission errors, add your user to the \`dialout\` group:
\`\`\`bash
sudo usermod -aG dialout $USER
\`\`\`
Then log out and back in for changes to take effect.
</Admonition>

---

### Step 2: Core Implementation

#### 2.1 Create the Main Node

Create \`physical_ai_lab/main_node.py\`:

\`\`\`python
#!/usr/bin/env python3
"""
Main ROS 2 Node for {{TITLE}} Lab
Demonstrates core concepts from theoretical section
"""

import rclpy
from rclpy.node import Node
from std_msgs.msg import String
from geometry_msgs.msg import Twist
import numpy as np


class PhysicalAINode(Node):
    """
    Main node implementing {{TITLE}} functionality
    """
    
    def __init__(self):
        super().__init__('physical_ai_node')
        
        # Declare parameters
        self.declare_parameter('update_rate', 10.0)
        self.declare_parameter('debug_mode', False)
        
        # Get parameters
        self.update_rate = self.get_parameter('update_rate').value
        self.debug_mode = self.get_parameter('debug_mode').value
        
        # Publishers
        self.cmd_vel_pub = self.create_publisher(
            Twist, 
            '/cmd_vel', 
            10
        )
        
        # Subscribers
        self.sensor_sub = self.create_subscription(
            String,
            '/sensor_data',
            self.sensor_callback,
            10
        )
        
        # Timers
        self.timer = self.create_timer(
            1.0 / self.update_rate,
            self.control_loop
        )
        
        # State variables
        self.state = {
            'position': np.array([0.0, 0.0, 0.0]),
            'velocity': np.array([0.0, 0.0, 0.0]),
            'sensor_data': None
        }
        
        self.get_logger().info('Physical AI Node initialized successfully')
    
    def sensor_callback(self, msg: String):
        """Process incoming sensor data"""
        self.state['sensor_data'] = msg.data
        
        if self.debug_mode:
            self.get_logger().debug(f'Received sensor data: {msg.data}')
    
    def control_loop(self):
        """Main control loop - executes at update_rate Hz"""
        # Implement your control logic here
        cmd = Twist()
        
        # Example: Simple proportional controller
        target_position = np.array([1.0, 0.0, 0.0])
        error = target_position - self.state['position']
        
        # Proportional gain
        Kp = 0.5
        cmd.linear.x = float(Kp * error[0])
        cmd.linear.y = float(Kp * error[1])
        
        # Publish command
        self.cmd_vel_pub.publish(cmd)
        
        # Update state (simple integration for simulation)
        dt = 1.0 / self.update_rate
        self.state['velocity'] = np.array([cmd.linear.x, cmd.linear.y, 0.0])
        self.state['position'] += self.state['velocity'] * dt
        
        if self.debug_mode:
            self.get_logger().info(f'Position: {self.state["position"]}')


def main(args=None):
    rclpy.init(args=args)
    node = PhysicalAINode()
    
    try:
        rclpy.spin(node)
    except KeyboardInterrupt:
        pass
    finally:
        node.destroy_node()
        rclpy.shutdown()


if __name__ == '__main__':
    main()
\`\`\`

<Admonition type="info" title="Code Explanation">
**Key Components:**
- **Parameters**: Configurable values loaded from YAML files
- **Publishers**: Send commands to other nodes/hardware
- **Subscribers**: Receive data from sensors/other nodes
- **Timer**: Executes control loop at fixed frequency
- **State Management**: Tracks robot's internal state
</Admonition>

---

### Step 3: Build and Test

#### 3.1 Build the Package

\`\`\`bash
# Navigate to workspace root
cd ~/robotics_ws

# Source ROS 2
source /opt/ros/humble/setup.bash

# Build the package
colcon build --packages-select physical_ai_lab

# Source the workspace
source install/setup.bash
\`\`\`

<Admonition type="success" title="Build Success">
If the build completes without errors, you should see:
\`\`\`
Summary: 1 package finished [X.XXs]
\`\`\`
</Admonition>

#### 3.2 Run the Node

<Tabs>
  <TabItem value="basic" label="Basic Execution" default>
    \`\`\`bash
    # Launch the node with default parameters
    ros2 launch physical_ai_lab lab_launch.py
    \`\`\`
  </TabItem>
  
  <TabItem value="debug" label="Debug Mode">
    \`\`\`bash
    # Launch with debug logging enabled
    ros2 launch physical_ai_lab lab_launch.py debug_mode:=true
    \`\`\`
  </TabItem>
</Tabs>

---

### Troubleshooting Guide

<Tabs>
  <TabItem value="build_errors" label="Build Errors" default>
    **Problem**: \`Package 'physical_ai_lab' not found\`
    
    **Solution**:
    \`\`\`bash
    # Verify package.xml exists
    ls ~/robotics_ws/src/physical_ai_lab/package.xml
    
    # Clean and rebuild
    cd ~/robotics_ws
    rm -rf build/ install/ log/
    colcon build
    \`\`\`
  </TabItem>
</Tabs>

---

### Summary

✅ You've successfully implemented **{{TITLE}}**  
✅ Built a complete ROS 2 package from scratch  
✅ Tested the system in simulation  

**Next**: Proceed to the Assessment section!