"use strict";(globalThis.webpackChunktmp_docusaurus_project=globalThis.webpackChunktmp_docusaurus_project||[]).push([[9792],{1235:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>a,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"module-3/chapter-9","title":"Chapter 9: Navigation with ROS 2 Nav2","description":"\ud83c\udfaf Objective","source":"@site/docs/module-3/chapter-9.md","sourceDirName":"module-3","slug":"/module-3/chapter-9","permalink":"/roboailearner/docs/module-3/chapter-9","draft":false,"unlisted":false,"editUrl":"https://github.com/EngineerAbdullahIqbal/roboailearner/tree/main/robotics_book_content/docs/module-3/chapter-9.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Chapter 8: Robot Control: Actuators, Joints, and PID","permalink":"/roboailearner/docs/module-3/chapter-8"},"next":{"title":"Chapter 10: Vision-Language-Action (VLA) Models for Humanoids","permalink":"/roboailearner/docs/module-4/chapter-10"}}');var o=t(4848),s=t(8453),r=t(6245);const a={},l="Chapter 9: Navigation with ROS 2 Nav2",c={},d=[{value:"\ud83c\udfaf Objective",id:"-objective",level:3},{value:"\ud83e\udde0 Theory: The Map and the Territory",id:"-theory-the-map-and-the-territory",level:3},{value:"1. Localization (AMCL / SLAM)",id:"1-localization-amcl--slam",level:4},{value:"2. Global Planning",id:"2-global-planning",level:4},{value:"3. Local Planning (Controller)",id:"3-local-planning-controller",level:4},{value:"\ud83d\udee0\ufe0f Architecture: The Nav2 Stack",id:"\ufe0f-architecture-the-nav2-stack",level:3},{value:"\ud83d\udcbb Implementation: Simple Nav2 Action Client",id:"-implementation-simple-nav2-action-client",level:3},{value:"\u26a0\ufe0f Common Pitfalls (Sim vs. Real)",id:"\ufe0f-common-pitfalls-sim-vs-real",level:3},{value:"\ud83e\uddea Verification",id:"-verification",level:3},{value:"\ud83d\udcdd Chapter Summary",id:"-chapter-summary",level:3},{value:"\ud83d\udd1a Conclusion",id:"-conclusion",level:3}];function h(e){const n={code:"code",h1:"h1",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"chapter-9-navigation-with-ros-2-nav2",children:"Chapter 9: Navigation with ROS 2 Nav2"})}),"\n",(0,o.jsx)(n.h3,{id:"-objective",children:"\ud83c\udfaf Objective"}),"\n",(0,o.jsx)(n.p,{children:"This chapter enables your robot to move autonomously. We will explore the ROS 2 Navigation Stack (Nav2), understanding how it combines SLAM (Simultaneous Localization and Mapping), global planning (GPS-style), and local planning (obstacle avoidance) to safely traverse the physical world."}),"\n",(0,o.jsx)(n.h3,{id:"-theory-the-map-and-the-territory",children:"\ud83e\udde0 Theory: The Map and the Territory"}),"\n",(0,o.jsx)(n.p,{children:'Navigation answers three questions: "Where am I?", "Where am I going?", and "How do I get there?".'}),"\n",(0,o.jsx)(n.h4,{id:"1-localization-amcl--slam",children:"1. Localization (AMCL / SLAM)"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Problem:"})," Odometry (counting wheel turns) drifts over time. Tires slip."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Solution:"})," Match lidar scans to a known map (AMCL) or build the map while exploring (SLAM)."]}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"2-global-planning",children:"2. Global Planning"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Problem:"})," Find a path across the building."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Solution:"}),' A* or Dijkstra\'s algorithm on a static costmap. "Go down the hallway, turn left."']}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"3-local-planning-controller",children:"3. Local Planning (Controller)"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Problem:"})," Follow the global path while avoiding a person who just stepped in front of you."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Solution:"})," Dynamic Window Approach (DWA) or MPPI (Model Predictive Path Integral). Simulates short trajectories and picks the best one that avoids collisions and progresses along the path."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"\ufe0f-architecture-the-nav2-stack",children:"\ud83d\udee0\ufe0f Architecture: The Nav2 Stack"}),"\n","\n",(0,o.jsx)(r.A,{id:"9.1"}),"\n",(0,o.jsx)(n.h3,{id:"-implementation-simple-nav2-action-client",children:"\ud83d\udcbb Implementation: Simple Nav2 Action Client"}),"\n",(0,o.jsx)(n.p,{children:"Instead of using RViz buttons, we can send goals programmatically."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom rclpy.action import ActionClient\nfrom nav2_msgs.action import NavigateToPose\n\nclass NavToPoseClient(Node):\n    def __init__(self):\n        super().__init__('nav_to_pose_client')\n        self._action_client = ActionClient(self, NavigateToPose, 'navigate_to_pose')\n\n    def send_goal(self, x, y, w):\n        goal_msg = NavigateToPose.Goal()\n        goal_msg.pose.header.frame_id = 'map'\n        goal_msg.pose.pose.position.x = x\n        goal_msg.pose.pose.position.y = y\n        goal_msg.pose.pose.orientation.w = w # Simplified quaternion\n\n        self._action_client.wait_for_server()\n        return self._action_client.send_goal_async(goal_msg)\n\ndef main(args=None):\n    rclpy.init(args=args)\n    client = NavToPoseClient()\n    future = client.send_goal(2.0, 0.0, 1.0)\n    rclpy.spin_until_future_complete(client, future)\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,o.jsx)(n.h3,{id:"\ufe0f-common-pitfalls-sim-vs-real",children:"\u26a0\ufe0f Common Pitfalls (Sim vs. Real)"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Simulation:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Perfect Surfaces:"})," Wheels never slip. Odometry is 100% accurate."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Static World:"})," Obstacles don't move unless programmed to."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Perfect Lidar:"})," No glass walls, no black absorptive objects."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Reality:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Wheel Slip:"})," On polished concrete or carpet, wheels slip. The robot thinks it moved 1 meter forward, but it only moved 0.9m. Localization (AMCL) must correct this jumps (TF correction)."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Dynamic Obstacles:"})," People, pets, and doors opening/closing require a reactive Local Planner (Controller) running at high frequency."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Invisible Obstacles:"}),' Lidar passes through glass tables. Depth cameras struggle with sunlight. The Costmap must be tuned to "inflate" obstacles safely.']}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:'The "Kidnapped Robot":'})," If you pick up the robot and move it, its localization breaks. It needs to be re-initialized."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Fix:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Sensor Fusion:"})," Fuse IMU (gyro) with Wheel Encoders (EKF) to handle slip."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Costmap Tuning:"})," Adjust inflation radius and obstacle clearing parameters carefully."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Recovery Behaviors:"}),' Enable Nav2 "Recoveries" (spin, back up, wait) to handle stuck situations.']}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"-verification",children:"\ud83e\uddea Verification"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Map Generation:"})," Run ",(0,o.jsx)(n.code,{children:"ros2 launch slam_toolbox online_async_launch.py"}),". Drive the robot around. Does the map look like the room? Straight walls?"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Localization:"})," drive the robot fast and spin. Does the laser scan stay aligned with the map? If it drifts, your Odometry/TF is bad."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Navigation:"})," Send a goal behind an obstacle. Does the global planner find a path around it?"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Dynamic Avoidance:"})," Stand in the robot's path. Does it stop or re-route?"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"-chapter-summary",children:"\ud83d\udcdd Chapter Summary"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Navigation"})," is the art of moving from A to B safely."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Localization"})," (Where am I?) relies on fusing noisy sensors (Odom, IMU, Lidar) to estimate position on a map."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Nav2"})," uses a layered Costmap (Static + Dynamic obstacles) and separate Global/Local planners."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Physical Reality"})," introduces wheel slip and sensor blindness (glass), necessitating robust recovery behaviors and sensor fusion."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"-conclusion",children:"\ud83d\udd1a Conclusion"}),"\n",(0,o.jsx)(n.p,{children:"Navigation transforms a robot from a remote-controlled toy into an autonomous agent. By mastering Nav2, you empower your robot to explore, map, and traverse the physical world. However, the reliability of this navigation is entirely dependent on the quality of the underlying sensor data and control loops we built in previous chapters. A robot that cannot trust its senses or its wheels is a robot that is lost."})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}},6245:(e,n,t)=>{t.d(n,{A:()=>b});var i=t(6540),o=t(4922),s=t(9437),r=t(7024);class a{frameId=null;constructor(e){this.container=e;try{this.renderer=new s.JeP({antialias:!0,alpha:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(e.clientWidth,e.clientHeight),this.renderer.domElement.tabIndex=0,this.renderer.domElement.style.outline="none",e.appendChild(this.renderer.domElement)}catch(i){throw new Error("WebGL is not supported in this browser.")}this.scene=new o.Z58,this.scene.background=new o.Q1f(15790320),this.camera=new o.ubm(45,e.clientWidth/e.clientHeight,.1,1e3),this.camera.position.set(0,5,10),this.camera.lookAt(0,0,0),this.controls=new r.N(this.camera,this.renderer.domElement),this.controls.enableDamping=!0;const n=new o.$p8(16777215,.6);this.scene.add(n);const t=new o.ZyN(16777215,.8);t.position.set(5,10,5),this.scene.add(t),window.addEventListener("resize",this.onWindowResize)}onWindowResize=()=>{this.container&&(this.camera.aspect=this.container.clientWidth/this.container.clientHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight))};start(){this.frameId||this.animate()}stop(){this.frameId&&(cancelAnimationFrame(this.frameId),this.frameId=null)}animate=()=>{this.frameId=requestAnimationFrame(this.animate),this.controls.update(),this.renderer.render(this.scene,this.camera)};getScene(){return this.scene}getCamera(){return this.camera}getControls(){return this.controls}dispose(){this.stop(),window.removeEventListener("resize",this.onWindowResize),this.renderer.dispose(),this.container.contains(this.renderer.domElement)&&this.container.removeChild(this.renderer.domElement)}}class l{manifest=null;constructor(e="/3d/manifest.json"){this.manifestUrl=e}async loadManifest(){if(this.manifest)return this.manifest;try{const e=await fetch(this.manifestUrl);if(!e.ok)throw new Error(`Failed to load manifest: ${e.statusText}`);return this.manifest=await e.json(),this.manifest}catch(e){throw console.error("SceneLoader error:",e),e}}getSceneConfig(e){return this.manifest?.scenes[e]}}class c{nodes=new Map;constructor(e){this.scene=e}build(e){this.clear(),e.nodes.forEach(e=>{const n=this.createNode(e);this.scene.add(n),this.nodes.set(e.id,n)}),e.edges.forEach(e=>{const n=this.nodes.get(e.from),t=this.nodes.get(e.to);if(n&&t){const i=this.createEdge(n.position,t.position,e);this.scene.add(i)}})}createNode(e){let n;switch(e.type){case"sphere":n=new o.Gu$(.5,32,32);break;case"cylinder":n=new o.Ho_(.5,.5,1,32);break;default:n=new o.iNn(1,1,1)}const t=new o._4j({color:e.color||"#007bff",roughness:.7,metalness:.3}),i=new o.eaF(n,t);return i.position.set(...e.pos),i.userData={id:e.id,label:e.label,isNode:!0},i}createEdge(e,n,t){const i=new o.VnP(e,n),s=new o.j6(i,20,.05,8,!1),r=new o.V9B({color:t.color||"#999",transparent:!0,opacity:.6});return new o.eaF(s,r)}clear(){this.nodes.clear()}}var d=t(2763);class h{robotModel=null;annotations=new Map;constructor(e){this.scene=e,this.loader=new d.B}async build(e,n){return this.clear(),new Promise((t,i)=>{this.loader.load(n,n=>{this.robotModel=n.scene,this.scene.add(this.robotModel),e.highlight_bones&&e.highlight_bones.forEach(e=>{const n=this.robotModel?.getObjectByName(e);if(n){const e=new o.IzY(.5);n.add(e)}}),t()},void 0,e=>{console.error("An error happened loading the robot model:",e);const n=new o.iNn(1,2,1),i=new o._4j({color:8947848});this.robotModel=new o.eaF(n,i),this.scene.add(this.robotModel),t()})})}getAnnotationPositions(e){const n=[];return this.robotModel&&e.annotations?(e.annotations.forEach(e=>{const t=this.robotModel.getObjectByName(e.target_bone);if(t){const i=new o.Pq0;t.getWorldPosition(i),n.push({id:e.id,position:i})}else console.warn(`Bone ${e.target_bone} not found for annotation ${e.id}`)}),n):n}clear(){this.robotModel&&(this.scene.remove(this.robotModel),this.robotModel=null)}}class u{pointCloud=null;constructor(e){this.scene=e}build(e){this.clear(),e.source_image?this.buildFromImage(e.source_image):this.buildRandom()}buildRandom(){const e=new o.LoY,n=5e3,t=new Float32Array(15e3),i=new Float32Array(15e3);for(let o=0;o<n;o++){const e=10*(Math.random()-.5),n=10*(Math.random()-.5),s=10*(Math.random()-.5);t[3*o]=e,t[3*o+1]=n,t[3*o+2]=s,i[3*o]=(e+5)/10,i[3*o+1]=(n+5)/10,i[3*o+2]=(s+5)/10}e.setAttribute("position",new o.THS(t,3)),e.setAttribute("color",new o.THS(i,3));const s=new o.BH$({size:.1,vertexColors:!0});this.pointCloud=new o.ONl(e,s),this.scene.add(this.pointCloud)}buildFromImage(e){(new o.Tap).load(e,e=>{const n=100,t=100,i=new o.LoY,s=new Float32Array(3e4),r=document.createElement("canvas");r.width=e.image.width,r.height=e.image.height;const a=r.getContext("2d");if(a){a.drawImage(e.image,0,0);const l=a.getImageData(0,0,r.width,r.height).data;let c=0;for(let i=0;i<n;i++)for(let o=0;o<t;o++){const r=.1*(i-50),a=.1*(o-50),d=Math.floor(i/n*e.image.width),h=5*(l[4*(Math.floor(o/t*e.image.height)*e.image.width+d)]/255);s[c]=r,s[c+1]=a,s[c+2]=h,c+=3}i.setAttribute("position",new o.THS(s,3));const d=new o.BH$({size:.05,color:65535});this.pointCloud=new o.ONl(i,d),this.scene.add(this.pointCloud)}})}clear(){this.pointCloud&&(this.scene.remove(this.pointCloud),this.pointCloud.geometry.dispose(),this.pointCloud.material.dispose(),this.pointCloud=null)}}var p=t(8478),m=t(6025),g=t(4848);const f=({id:e,height:n="400px",width:t="100%",fallbackImage:s})=>{const r=(0,i.useRef)(null),d=(0,i.useRef)(null),[p,f]=(0,i.useState)(null),[b,x]=(0,i.useState)(!0),[j,v]=(0,i.useState)([]),w=(0,i.useRef)(),y=(0,m.Ay)("/3d/manifest.json");return(0,i.useEffect)(()=>{let n=!0;return(async()=>{if(r.current)try{d.current=new a(r.current);const t=new l(y);await t.loadManifest();const i=t.getSceneConfig(e);if(!i)throw new Error(`Scene ID "${e}" not found in manifest.`);if(!n)return;if(i.camera){const e=d.current.getCamera();e.position.set(...i.camera.position),e.lookAt(...i.camera.target),i.camera.fov&&(e.fov=i.camera.fov),e.updateProjectionMatrix()}if("flow"===i.type){new c(d.current.getScene()).build(i.config);const e=[];i.config.nodes.forEach(n=>{e.push({id:n.id,text:n.label,position:new o.Pq0(...n.pos)})}),v(e)}else if("robot"===i.type){const e=new h(d.current.getScene()),n=i.config.model,t=i.assets?.find(e=>e.id===n),o=t?t.url:"";await e.build(i.config,o);const s=e.getAnnotationPositions(i.config),r=[];i.config.annotations?.forEach(e=>{const n=s.find(n=>n.id===e.id);n&&r.push({id:e.id,text:e.text||e.label,position:n.position})}),v(r)}else if("pointcloud"===i.type){new u(d.current.getScene()).build(i.config)}d.current.start(),x(!1)}catch(t){console.error("ThreeDiagram Init Error:",t),n&&f(t instanceof Error?t.message:String(t))}})(),()=>{n=!1,w.current&&cancelAnimationFrame(w.current),d.current&&(d.current.dispose(),d.current=null)}},[e]),(0,i.useEffect)(()=>{if(0===j.length||!d.current)return;const n=()=>{if(!d.current||!r.current)return;const t=d.current.getCamera(),i=r.current.clientWidth,o=r.current.clientHeight,s=i/2,a=o/2;j.forEach(n=>{const i=document.getElementById(`label-${e}-${n.id}`);if(!i)return;const o=n.position.clone();if(o.y+=.8,o.project(t),o.z<1){i.style.display="block";const e=o.x*s+s,n=-o.y*a+a;i.style.transform=`translate(-50%, -50%) translate(${e}px, ${n}px)`}else i.style.display="none"}),w.current=requestAnimationFrame(n)};return n(),()=>{w.current&&cancelAnimationFrame(w.current)}},[j,e]),p?(0,g.jsx)("div",{style:{width:t,height:n,background:"#f8d7da",color:"#721c24",padding:"20px",display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid #f5c6cb",borderRadius:"4px"},children:(0,g.jsxs)("div",{children:[(0,g.jsx)("strong",{children:"Error loading 3D Diagram:"})," ",p,s&&(0,g.jsx)("img",{src:s,alt:"Fallback",style:{maxWidth:"100%",marginTop:"10px"}})]})}):(0,g.jsxs)("div",{style:{position:"relative",width:t,height:n,overflow:"hidden",borderRadius:"8px",border:"1px solid #ddd",background:"#f0f0f0"},role:"region","aria-label":`Interactive 3D Diagram: ${e}`,children:[b&&(0,g.jsx)("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"#eee",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10},children:"Loading 3D Scene..."}),(0,g.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",overflow:"hidden"},children:j.map(n=>(0,g.jsx)("div",{id:`label-${e}-${n.id}`,style:{position:"absolute",top:0,left:0,background:"rgba(255, 255, 255, 0.8)",padding:"2px 6px",borderRadius:"4px",fontSize:"12px",fontWeight:"bold",color:"#333",boxShadow:"0 1px 3px rgba(0,0,0,0.2)",whiteSpace:"nowrap",display:"none",willChange:"transform"},children:n.text},n.id))}),(0,g.jsx)("div",{ref:r,style:{width:"100%",height:"100%"},"aria-label":`3D Diagram: ${e}`,role:"img"})]})};function b(e){return(0,g.jsx)(p.A,{fallback:(0,g.jsx)("div",{style:{height:e.height||"400px",background:"#eee"},children:"Loading..."}),children:()=>(0,g.jsx)(f,{...e})})}}}]);