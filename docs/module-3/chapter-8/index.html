<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-module-3/chapter-8" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Chapter 8: Robot Control: Actuators, Joints, and PID | Physical AI &amp; Humanoid Robotics</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://engineerabdullahiqbal.github.io/roboailearner/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://engineerabdullahiqbal.github.io/roboailearner/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://engineerabdullahiqbal.github.io/roboailearner/docs/module-3/chapter-8"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Chapter 8: Robot Control: Actuators, Joints, and PID | Physical AI &amp; Humanoid Robotics"><meta data-rh="true" name="description" content="üéØ Objective"><meta data-rh="true" property="og:description" content="üéØ Objective"><link data-rh="true" rel="icon" href="/roboailearner/img/book-logo.png"><link data-rh="true" rel="canonical" href="https://engineerabdullahiqbal.github.io/roboailearner/docs/module-3/chapter-8"><link data-rh="true" rel="alternate" href="https://engineerabdullahiqbal.github.io/roboailearner/docs/module-3/chapter-8" hreflang="en"><link data-rh="true" rel="alternate" href="https://engineerabdullahiqbal.github.io/roboailearner/docs/module-3/chapter-8" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Chapter 8: Robot Control: Actuators, Joints, and PID","item":"https://engineerabdullahiqbal.github.io/roboailearner/docs/module-3/chapter-8"}]}</script><link rel="alternate" type="application/rss+xml" href="/roboailearner/blog/rss.xml" title="Physical AI &amp; Humanoid Robotics RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/roboailearner/blog/atom.xml" title="Physical AI &amp; Humanoid Robotics Atom Feed"><link rel="stylesheet" href="/roboailearner/assets/css/styles.3fa040d2.css">
<script src="/roboailearner/assets/js/runtime~main.16f9f18e.js" defer="defer"></script>
<script src="/roboailearner/assets/js/main.9a4a5260.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/roboailearner/img/book-logo.png"> <div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/roboailearner/"><div class="navbar__logo"><img src="/roboailearner/img/book-logo.png" alt="Physical AI Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/roboailearner/img/book-logo.png" alt="Physical AI Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Physical AI Book</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/roboailearner/docs/course-outline">Curriculum</a><a class="navbar__item navbar__link" href="/roboailearner/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/EngineerAbdullahIqbal/hackathon-book-project" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/roboailearner/docs/course-outline"><span title="Physical AI &amp; Humanoid Robotics: Course Outline" class="linkLabel_WmDU">Physical AI &amp; Humanoid Robotics: Course Outline</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/roboailearner/docs/module-1/chapter-1"><span title="Module 1: Foundations of Physical AI &amp; ROS 2" class="categoryLinkLabel_W154">Module 1: Foundations of Physical AI &amp; ROS 2</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/roboailearner/docs/module-2/chapter-4"><span title="Module 2: Sensing and Perception for Humanoids" class="categoryLinkLabel_W154">Module 2: Sensing and Perception for Humanoids</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/roboailearner/docs/module-3/chapter-7"><span title="Module 3: Motion, Control, and Navigation" class="categoryLinkLabel_W154">Module 3: Motion, Control, and Navigation</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/roboailearner/docs/module-3/chapter-7"><span title="Chapter 7: Inverse Kinematics and Humanoid Motion Planning" class="linkLabel_WmDU">Chapter 7: Inverse Kinematics and Humanoid Motion Planning</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/roboailearner/docs/module-3/chapter-8"><span title="Chapter 8: Robot Control: Actuators, Joints, and PID" class="linkLabel_WmDU">Chapter 8: Robot Control: Actuators, Joints, and PID</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/roboailearner/docs/module-3/chapter-9"><span title="Chapter 9: Navigation with ROS 2 Nav2" class="linkLabel_WmDU">Chapter 9: Navigation with ROS 2 Nav2</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/roboailearner/docs/module-4/chapter-10"><span title="Module 4: Advanced Topics and Real-World Deployment" class="categoryLinkLabel_W154">Module 4: Advanced Topics and Real-World Deployment</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/roboailearner/docs/module-5/chapter-14-student-projects"><span title="Module 5: Capstone Projects" class="categoryLinkLabel_W154">Module 5: Capstone Projects</span></a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/roboailearner/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Module 3: Motion, Control, and Navigation</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Chapter 8: Robot Control: Actuators, Joints, and PID</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Chapter 8: Robot Control: Actuators, Joints, and PID</h1></header>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="-objective">üéØ Objective<a href="#-objective" class="hash-link" aria-label="Direct link to üéØ Objective" title="Direct link to üéØ Objective" translate="no">‚Äã</a></h3>
<p>This chapter bridges the gap between a motion plan (trajectory) and the physical voltage applied to motors. We will dissect the PID controller, the workhorse of robotics, and explore the nuances of controlling actuators in the real world.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="-theory-the-physics-of-control">üß† Theory: The Physics of Control<a href="#-theory-the-physics-of-control" class="hash-link" aria-label="Direct link to üß† Theory: The Physics of Control" title="Direct link to üß† Theory: The Physics of Control" translate="no">‚Äã</a></h3>
<p>A motion planner tells the robot <em>where</em> to be. The controller ensures it <em>gets there</em> and <em>stays there</em>.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-the-control-loop">1. The Control Loop<a href="#1-the-control-loop" class="hash-link" aria-label="Direct link to 1. The Control Loop" title="Direct link to 1. The Control Loop" translate="no">‚Äã</a></h4>
<ol>
<li class=""><strong>Reference (Set Point):</strong> Where we want to be (e.g., Joint angle = 90¬∞).</li>
<li class=""><strong>Error:</strong> Difference between Reference and Current State.</li>
<li class=""><strong>Control Effort:</strong> The command sent to the actuator (e.g., Voltage, Current, Torque).</li>
</ol>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-pid-control">2. PID Control<a href="#2-pid-control" class="hash-link" aria-label="Direct link to 2. PID Control" title="Direct link to 2. PID Control" translate="no">‚Äã</a></h4>
<ul>
<li class=""><strong>Proportional (Kp):</strong> Spring-like force. Pulls toward the target. High Kp = stiff, fast, but overshoots.</li>
<li class=""><strong>Integral (Ki):</strong> Memory of past errors. Pushes harder if the error persists (e.g., holding up an arm against gravity). Fixes steady-state error.</li>
<li class=""><strong>Derivative (Kd):</strong> Damper/Friction. Resists change. Slows down the movement to prevent overshoot.</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="3-actuators">3. Actuators<a href="#3-actuators" class="hash-link" aria-label="Direct link to 3. Actuators" title="Direct link to 3. Actuators" translate="no">‚Äã</a></h4>
<ul>
<li class=""><strong>DC Motors:</strong> Common, easy to control.</li>
<li class=""><strong>BLDC (Brushless):</strong> High efficiency, high torque, used in high-end humanoids (Unitree, Tesla Optimus).</li>
<li class=""><strong>Series Elastic Actuators (SEA):</strong> Include a spring for compliance and shock absorption.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="Ô∏è-architecture-the-ros2_control-stack">üõ†Ô∏è Architecture: The ros2_control Stack<a href="#Ô∏è-architecture-the-ros2_control-stack" class="hash-link" aria-label="Direct link to üõ†Ô∏è Architecture: The ros2_control Stack" title="Direct link to üõ†Ô∏è Architecture: The ros2_control Stack" translate="no">‚Äã</a></h3>
<!-- -->
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="-implementation-custom-pid-controller-node">üíª Implementation: Custom PID Controller Node<a href="#-implementation-custom-pid-controller-node" class="hash-link" aria-label="Direct link to üíª Implementation: Custom PID Controller Node" title="Direct link to üíª Implementation: Custom PID Controller Node" translate="no">‚Äã</a></h3>
<p>While <code>ros2_control</code> is the standard, writing a simple PID loop demystifies the magic.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> rclpy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> rclpy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">node </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> std_msgs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">msg </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Float64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">SimplePID</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__init__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">super</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">__init__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;simple_pid&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">target_sub </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">create_subscription</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Float64</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/joint/target&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">target_cb</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">state_sub </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">create_subscription</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Float64</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/joint/state&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">state_cb</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cmd_pub </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">create_publisher</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Float64</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/joint/cmd_voltage&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">kp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ki </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">kd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">target </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">current </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">integral </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">prev_error </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">timer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">create_timer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.01</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">loop</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 100Hz</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">target_cb</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">target </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">state_cb</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">current </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">loop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        error </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">target </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">current</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        dt </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.01</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">integral </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> error </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> dt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        derivative </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">error </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">prev_error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> dt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        output </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">kp </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ki </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">integral</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">kd </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> derivative</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Clamp output to physical limits (e.g., +/- 12V)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        output </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">max</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">12.0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">min</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">12.0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> output</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        msg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Float64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> output</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cmd_pub</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">publish</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">prev_error </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> error</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">args</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rclpy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">args</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> SimplePID</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rclpy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">spin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">destroy_node</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rclpy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shutdown</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;__main__&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="Ô∏è-common-pitfalls-sim-vs-real">‚ö†Ô∏è Common Pitfalls (Sim vs. Real)<a href="#Ô∏è-common-pitfalls-sim-vs-real" class="hash-link" aria-label="Direct link to ‚ö†Ô∏è Common Pitfalls (Sim vs. Real)" title="Direct link to ‚ö†Ô∏è Common Pitfalls (Sim vs. Real)" translate="no">‚Äã</a></h3>
<ul>
<li class="">
<p><strong>Simulation:</strong></p>
<ul>
<li class=""><strong>Ideal Actuators:</strong> Motors produce exact torque instantly.</li>
<li class=""><strong>No Friction:</strong> Joints move effortlessly.</li>
<li class=""><strong>Rigid Body:</strong> No flexing or vibration.</li>
</ul>
</li>
<li class="">
<p><strong>Reality:</strong></p>
<ul>
<li class=""><strong>Stiction (Static Friction):</strong> The joint won&#x27;t move until a certain voltage threshold is crossed. This causes &quot;stick-slip&quot; motion (jerky movement) at low speeds.</li>
<li class=""><strong>Gravity:</strong> Holding an arm out requires constant torque. A pure P-controller will sag (Steady-state error). You need an <strong>I-term</strong> or, better yet, <strong>Feedforward Gravity Compensation</strong>.</li>
<li class=""><strong>Noise:</strong> Derivative terms amplify sensor noise. A noisy encoder can make the motors hum or vibrate violently if Kd is too high.</li>
<li class=""><strong>Delay:</strong> Communication latency (USB/CAN) limits the max stable Gains.</li>
</ul>
</li>
<li class="">
<p><strong>Fix:</strong></p>
<ul>
<li class=""><strong>Gravity Compensation:</strong> Add a term to the output based on the physics model: <code>Output = PID + G(theta)</code>.</li>
<li class=""><strong>Deadband Compensation:</strong> Add a minimum voltage offset to overcome stiction.</li>
<li class=""><strong>Low-Pass Filter:</strong> Filter the velocity signal before calculating the D-term to reduce noise.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="-verification">üß™ Verification<a href="#-verification" class="hash-link" aria-label="Direct link to üß™ Verification" title="Direct link to üß™ Verification" translate="no">‚Äã</a></h3>
<ol>
<li class=""><strong>Step Response:</strong> Command the joint to move from 0¬∞ to 10¬∞ instantly.<!-- -->
<ul>
<li class=""><strong>Over-damped:</strong> Moves slowly, no overshoot.</li>
<li class=""><strong>Under-damped:</strong> Overshoots, oscillates, then settles.</li>
<li class=""><strong>Critically damped:</strong> Fastest rise time without overshoot.</li>
</ul>
</li>
<li class=""><strong>Disturbance Rejection:</strong> Push the robot arm. A good controller acts like a spring, pushing back to restore the position.</li>
<li class=""><strong>Steady-State Error:</strong> Hold the arm horizontally. Does it droop? If so, increase Ki or add gravity compensation.</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="-chapter-summary">üìù Chapter Summary<a href="#-chapter-summary" class="hash-link" aria-label="Direct link to üìù Chapter Summary" title="Direct link to üìù Chapter Summary" translate="no">‚Äã</a></h3>
<ul>
<li class=""><strong>Control Theory</strong> ensures physical motors faithfully execute software commands.</li>
<li class=""><strong>PID Controllers</strong> use Error (P), History (I), and Predicted Future (D) to calculate control signals.</li>
<li class=""><strong>ros2_control</strong> is the modular framework for abstracting hardware (drivers) from software (trajectory controllers).</li>
<li class=""><strong>Real-world actuators</strong> suffer from friction, gravity, and noise, requiring techniques like Gravity Compensation and Filtering to achieve smooth motion.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="-conclusion">üîö Conclusion<a href="#-conclusion" class="hash-link" aria-label="Direct link to üîö Conclusion" title="Direct link to üîö Conclusion" translate="no">‚Äã</a></h3>
<p>Code moves atoms, but Control Theory dictates <em>how gracefully</em> they move. A poorly tuned controller can turn an expensive humanoid robot into a flailing hazard. While simulation provides a safe sandbox for tuning gains, the final validation must always occur on hardware, where friction and gravity are the ultimate arbiters of success. With precise control established, we can now look outward to navigation.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/EngineerAbdullahIqbal/hackathon-book-project/tree/main/tmp_docusaurus_project/docs/module-3/chapter-8.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/roboailearner/docs/module-3/chapter-7"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Chapter 7: Inverse Kinematics and Humanoid Motion Planning</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/roboailearner/docs/module-3/chapter-9"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Chapter 9: Navigation with ROS 2 Nav2</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#-objective" class="table-of-contents__link toc-highlight">üéØ Objective</a></li><li><a href="#-theory-the-physics-of-control" class="table-of-contents__link toc-highlight">üß† Theory: The Physics of Control</a></li><li><a href="#Ô∏è-architecture-the-ros2_control-stack" class="table-of-contents__link toc-highlight">üõ†Ô∏è Architecture: The ros2_control Stack</a></li><li><a href="#-implementation-custom-pid-controller-node" class="table-of-contents__link toc-highlight">üíª Implementation: Custom PID Controller Node</a></li><li><a href="#Ô∏è-common-pitfalls-sim-vs-real" class="table-of-contents__link toc-highlight">‚ö†Ô∏è Common Pitfalls (Sim vs. Real)</a></li><li><a href="#-verification" class="table-of-contents__link toc-highlight">üß™ Verification</a></li><li><a href="#-chapter-summary" class="table-of-contents__link toc-highlight">üìù Chapter Summary</a></li><li><a href="#-conclusion" class="table-of-contents__link toc-highlight">üîö Conclusion</a></li></ul></div></div></div></div></main></div></div></div><button style="position:fixed;bottom:20px;right:20px;background-color:var(--ifm-color-primary);color:white;border:none;border-radius:50%;width:60px;height:60px;font-size:30px;cursor:pointer;box-shadow:0 4px 12px rgba(0, 0, 0, 0.2);z-index:1001;display:flex;align-items:center;justify-content:center">üí¨ </button></div>
</body>
</html>